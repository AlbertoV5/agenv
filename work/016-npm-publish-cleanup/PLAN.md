# Plan: Npm Publish Cleanup

> **Stream ID:** 016-npm-publish-cleanup | **Created:** 2026-01-29 | **Generated by:** @agenv/workstreams@0.1.0

## Summary

Prepare the `@agenv/workstreams` package for npm publishing with a proper build step that emits JavaScript + TypeScript declarations. This enables installation via `bun add -g @agenv/workstreams` (or npm/yarn) to run the `work` command globally from any directory. Also remove the unused `serve` web visualization command to reduce dependencies.

## References

- `packages/workstreams/package.json` - Current package configuration
- `packages/workstreams/src/index.ts` - Public API exports
- `packages/workstreams/bin/work.ts` - CLI entry point
- `packages/workstreams/src/cli/serve.ts` - Web visualization to remove

## Stages

### Stage 01: Build System & Cleanup

#### Stage Definition

Set up TypeScript compilation to emit `.js` and `.d.ts` files, remove the `serve` command and its React dependency, and update package.json for npm publishing.

#### Stage Constitution

**Inputs:**
- Current package structure with `.ts` source files
- Existing `tsconfig.json` configuration

**Structure:**
- Parallel threads for build setup, cleanup, and package config

**Outputs:**
- Working `bun run build` command that emits `dist/`
- Cleaned package without serve/React dependencies
- Updated package.json with proper npm publishing fields

#### Stage Questions

- [x] Should we keep Bun-specific APIs or make it Node.js compatible? → Keep Bun-specific for now, can add Node compatibility later
- [x] What features to remove? → Only `serve` (web visualization)

#### Stage Batches

##### Batch 01: Build & Cleanup

###### Thread 01: TypeScript Build Setup

**Summary:**
Configure TypeScript to compile the package to JavaScript with declaration files.

**Details:**
- Working packages: `./packages/workstreams`
- Create/update `tsconfig.build.json` for production builds
- Configure output to `dist/` directory
- Ensure source maps are generated
- Add `build` script to package.json
- Target: ES2022+ (modern Node.js/Bun)
- Module: ESNext with proper moduleResolution

###### Thread 02: Remove Serve Command

**Summary:**
Remove the web visualization feature and its React dependency.

**Details:**
- Working packages: `./packages/workstreams`
- Delete `src/cli/serve.ts`
- Remove serve from `bin/work.ts` command registry
- Remove React-related dependencies from package.json (`hono`, JSX runtime if any)
- Update any imports that reference serve

###### Thread 03: Package.json for NPM

**Summary:**
Update package.json with proper fields for npm publishing.

**Details:**
- Working packages: `./packages/workstreams`
- Add `main` field pointing to `dist/index.js`
- Add `types` field pointing to `dist/index.d.ts`
- Update `exports` to use compiled paths
- Update `bin` to point to compiled CLI
- Add `prepublishOnly` script that runs build
- Update `files` array to include `dist/`
- Ensure `repository`, `license`, `keywords` fields are set
- Add `engines` field for Node.js version

### Stage 02: Testing & Documentation

#### Stage Definition

Verify the build works correctly, test global installation, and update documentation.

#### Stage Constitution

**Inputs:**
- Built package from Stage 01

**Structure:**
- Sequential verification and documentation

**Outputs:**
- Verified working global installation
- Updated README with installation instructions

#### Stage Questions

- [x] Where to publish? → npm public registry (can use private later)

#### Stage Batches

##### Batch 01: Verification & Docs

###### Thread 01: Build Verification

**Summary:**
Test the build process and verify global installation works.

**Details:**
- Working packages: `./packages/workstreams`
- Run `bun run build` and verify output
- Test `bun link` for local global install
- Verify `work --help` works from any directory
- Test core commands work with compiled code
- Verify TypeScript types are correctly exported

###### Thread 02: Documentation Update

**Summary:**
Update README and installation docs for npm usage.

**Details:**
- Working packages: `./packages/workstreams`, `./`
- Update packages/workstreams/README.md with npm install instructions
- Add global installation section
- Document that `work` command becomes available globally
- Update main README.md to mention npm installation option

---

*Last updated: 2026-01-29*
