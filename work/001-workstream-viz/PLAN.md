# Plan: Workstream Viz

> **Stream ID:** 001-workstream-viz | **Created:** 2026-01-20 | **Generated by:** @agenv/workstreams@0.1.0

## Summary

Build a simple read-only web interface to visualize workstream progress. The website will display all workstreams, their hierarchical structure (stages → batches → threads → tasks), progress metrics, and status information. Accessible via a new `work serve` CLI command.

## References

- `packages/workstreams/src/lib/types.ts` - Data models and interfaces
- `packages/workstreams/src/lib/index.ts` - Index loading functions
- `packages/workstreams/src/lib/tasks.ts` - Task reading functions
- `packages/workstreams/src/lib/status.ts` - Progress calculation
- `packages/workstreams/src/lib/metrics.ts` - Metrics evaluation

## Stages

### Stage 01: Foundation

#### Stage Definition

Establish the core infrastructure: HTTP server, API endpoints, and data access layer that reads from existing workstream files.

#### Stage Constitution

**Inputs:** Existing workstream data files (index.json, tasks.json, PLAN.md)
**Structure:** Server module with REST API routes backed by data services
**Outputs:** Running HTTP server with JSON API endpoints

#### Stage Questions

- [x] Technology stack: Hono (lightweight HTTP framework) with server-rendered HTML
- [x] Data access: Reuse existing lib functions from workstreams package
- [x] No database needed - reads directly from work/ directory files

#### Stage Batches

##### Batch 01: Setup

Initializes the project configuration and dependencies.

###### Thread 01: Dependencies & Config

**Summary:**
Install required libraries and configure TypeScript for the web server.

**Details:**
- Add `hono` dependency to package.json
- Add `@hono/node-server` for Node.js adapter
- Update `tsconfig.json` to include JSX support for Hono (`"jsx": "react-jsx", "jsxImportSource": "hono/jsx"`)

##### Batch 02: Server Infrastructure

Sets up the HTTP server and routing foundation.

###### Thread 01: Server Module

**Summary:**
Create the HTTP server using Hono framework with basic configuration.

**Details:**
- Create `src/web/server.ts` with Hono app setup
- Configure server to serve on configurable port (default: 3456)
- Add static file serving for CSS/JS assets
- Export `startServer(options)` and `createApp()` functions
- Add graceful shutdown handling

###### Thread 02: API Routes

**Summary:**
Define REST API endpoints for accessing workstream data.

**Details:**
- `GET /api/workstreams` - List all workstreams with metadata
- `GET /api/workstreams/:id` - Get single workstream details
- `GET /api/workstreams/:id/tasks` - Get tasks for workstream
- `GET /api/workstreams/:id/progress` - Get progress summary
- `GET /api/workstreams/:id/plan` - Get parsed PLAN.md structure
- All responses return JSON

##### Batch 03: Data Layer

Creates the service layer for reading workstream data.

###### Thread 01: Data Service

**Summary:**
Create service module that wraps existing lib functions for web API use.

**Details:**
- Create `src/web/data-service.ts`
- `listWorkstreams()` - Load index and return formatted list
- `getWorkstream(id)` - Get single workstream with progress
- `getTasks(id)` - Get tasks with grouping by stage/batch/thread
- `getPlanStructure(id)` - Parse PLAN.md and return structure
- Handle errors gracefully, return appropriate error responses

### Stage 02: UI Views

#### Stage Definition

Build the HTML views and CSS styling for the read-only web interface.

#### Stage Constitution

**Inputs:** API endpoints from Stage 01, design requirements
**Structure:** Server-rendered HTML templates with minimal CSS
**Outputs:** Functional web pages for viewing workstreams

#### Stage Questions

- [x] Use server-rendered HTML (JSX via Hono) - keeps it simple, no build step for frontend
- [x] Minimal CSS - use simple utility classes, no framework needed
- [x] No JavaScript required for basic functionality - pure HTML views

#### Stage Batches

##### Batch 01: Layout & Navigation

Creates the base layout and navigation structure.

###### Thread 01: Base Layout

**Summary:**
Create the HTML shell, CSS styles, and navigation components.

**Details:**
- Create `src/web/views/layout.tsx` - Base HTML layout with JSX
- Create `src/web/views/styles.ts` - CSS as template literal (embedded)
- Include: header with title, main content area, basic responsive layout
- Color scheme: Use status colors (green=completed, blue=in_progress, gray=pending, red=blocked, yellow=cancelled)

##### Batch 02: Page Views

Creates the main page views for the application.

###### Thread 01: Dashboard View

**Summary:**
Create the home page showing all workstreams overview.

**Details:**
- Create `src/web/views/dashboard.tsx`
- Route: `GET /`
- Display: Card grid of all workstreams
- Each card shows: name, status badge, progress bar, task counts
- Link to detail view for each workstream
- Show "current" badge on active workstream

###### Thread 02: Workstream Detail View

**Summary:**
Create the detail page for a single workstream with full hierarchy.

**Details:**
- Create `src/web/views/workstream.tsx`
- Route: `GET /workstream/:id`
- Display:
  - Header with workstream name, status, approval info
  - Progress summary (completed/total tasks)
  - Collapsible stages with batches and threads
  - Each thread shows its tasks with status indicators
- Use semantic HTML: details/summary for collapsible sections

###### Thread 03: Task List View

**Summary:**
Create a flat task list view with filtering.

**Details:**
- Create `src/web/views/tasks.tsx`
- Route: `GET /workstream/:id/tasks`
- Display: Table of all tasks for workstream
- Columns: ID, Name, Stage, Batch, Thread, Status, Updated
- Filter by status via query params: `?status=pending`
- Sort by ID (default) or updated_at

### Stage 03: CLI Integration

#### Stage Definition

Integrate the web server into the existing CLI and add build configuration.

#### Stage Constitution

**Inputs:** Server module from Stage 01, existing CLI infrastructure
**Structure:** New CLI command that launches web server
**Outputs:** `work serve` command available in CLI

#### Stage Questions

- [x] Command name: `work serve` (matches common patterns)
- [x] Options: `--port` (default 3456), `--open` (open browser)

#### Stage Batches

##### Batch 01: CLI Command

Implements the serve command for the CLI.

###### Thread 01: Serve Command

**Summary:**
Add `work serve` command to launch the web visualization server.

**Details:**
- Create `src/cli/serve.ts`
- Options:
  - `--port, -p` - Port number (default: 3456)
  - `--open, -o` - Open browser automatically
  - `--host` - Host to bind (default: localhost)
- Display: URL when server starts, Ctrl+C to stop message
- Register in `bin/work.ts` dispatcher

###### Thread 02: Build Configuration

**Summary:**
Update package configuration for web assets.

**Details:**
- Add web-related files to build output
- Verify final package build includes all necessary files for `work serve`

---

*Last updated: 2026-01-20*
