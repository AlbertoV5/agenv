{
  "version": "1.0.0",
  "stream_id": "008-workstream-roles",
  "last_updated": "2026-01-23T15:43:39.222Z",
  "tasks": [
    {
      "id": "01.01.01.01",
      "name": "Create `packages/workstreams/src/lib/roles.ts` with `WorkstreamRole` type (\"USER\" | \"AGENT\") and `CommandPermission` interface",
      "stage_name": "Core Role Infrastructure",
      "batch_name": "Role System Foundation",
      "thread_name": "Core Role System",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "systems-engineer",
      "sessions": [],
      "github_issue": {
        "number": 18,
        "url": "https://github.com/AlbertoV5/agenv/issues/18",
        "state": "open"
      }
    },
    {
      "id": "01.01.01.02",
      "name": "Define `COMMAND_PERMISSIONS` registry with USER-only commands (approve, start, complete) and custom denial messages",
      "stage_name": "Core Role Infrastructure",
      "batch_name": "Role System Foundation",
      "thread_name": "Core Role System",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "systems-engineer",
      "sessions": []
    },
    {
      "id": "01.01.01.03",
      "name": "Implement `getCurrentRole()` function that reads `WORKSTREAM_ROLE` env var, defaulting to \"AGENT\"",
      "stage_name": "Core Role Infrastructure",
      "batch_name": "Role System Foundation",
      "thread_name": "Core Role System",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "systems-engineer",
      "sessions": []
    },
    {
      "id": "01.01.01.04",
      "name": "Implement `canExecuteCommand(command)` function to check if current role can execute a command",
      "stage_name": "Core Role Infrastructure",
      "batch_name": "Role System Foundation",
      "thread_name": "Core Role System",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "systems-engineer",
      "sessions": []
    },
    {
      "id": "01.01.01.05",
      "name": "Implement `getRoleDenialMessage(command)` function returning formatted access denied message",
      "stage_name": "Core Role Infrastructure",
      "batch_name": "Role System Foundation",
      "thread_name": "Core Role System",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "systems-engineer",
      "sessions": []
    },
    {
      "id": "01.01.01.06",
      "name": "Add helper `getCommandsForRole(role)` to list all commands available for a given role",
      "stage_name": "Core Role Infrastructure",
      "batch_name": "Role System Foundation",
      "thread_name": "Core Role System",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "systems-engineer",
      "sessions": []
    },
    {
      "id": "01.01.01.07",
      "name": "Export all types and functions from the module and add to `src/lib/index.ts` if applicable",
      "stage_name": "Core Role Infrastructure",
      "batch_name": "Role System Foundation",
      "thread_name": "Core Role System",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "systems-engineer",
      "sessions": []
    },
    {
      "id": "01.01.01.08",
      "name": "Write unit tests in `packages/workstreams/tests/roles.test.ts` for all role functions",
      "stage_name": "Core Role Infrastructure",
      "batch_name": "Role System Foundation",
      "thread_name": "Core Role System",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "systems-engineer",
      "sessions": []
    },
    {
      "id": "02.01.01.01",
      "name": "Create `packages/workstreams/src/lib/help.ts` with `getRoleHelpNote(command)` and `filterCommandsForRole(commands)` utilities",
      "stage_name": "CLI Integration",
      "batch_name": "Router and Command Updates",
      "thread_name": "Router and Help Integration",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "systems-engineer",
      "sessions": [],
      "github_issue": {
        "number": 19,
        "url": "https://github.com/AlbertoV5/agenv/issues/19",
        "state": "open"
      }
    },
    {
      "id": "02.01.01.02",
      "name": "Update `packages/workstreams/bin/work.ts` to import role and help utilities",
      "stage_name": "CLI Integration",
      "batch_name": "Router and Command Updates",
      "thread_name": "Router and Help Integration",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "systems-engineer",
      "sessions": []
    },
    {
      "id": "02.01.01.03",
      "name": "Add permission check before subcommand dispatch - call `canExecuteCommand()` and exit with denial message if rejected",
      "stage_name": "CLI Integration",
      "batch_name": "Router and Command Updates",
      "thread_name": "Router and Help Integration",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "systems-engineer",
      "sessions": []
    },
    {
      "id": "02.01.01.04",
      "name": "Update main help output to filter commands using `filterCommandsForRole()` based on current role",
      "stage_name": "CLI Integration",
      "batch_name": "Router and Command Updates",
      "thread_name": "Router and Help Integration",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "systems-engineer",
      "sessions": []
    },
    {
      "id": "02.01.01.05",
      "name": "Add footer to help output showing current role (e.g., \"Current role: AGENT\")",
      "stage_name": "CLI Integration",
      "batch_name": "Router and Command Updates",
      "thread_name": "Router and Help Integration",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "systems-engineer",
      "sessions": []
    },
    {
      "id": "02.01.01.06",
      "name": "Add `--show-all-commands` flag to display all commands regardless of role restrictions",
      "stage_name": "CLI Integration",
      "batch_name": "Router and Command Updates",
      "thread_name": "Router and Help Integration",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "systems-engineer",
      "sessions": []
    },
    {
      "id": "02.01.02.01",
      "name": "Update `packages/workstreams/src/cli/approve.ts` to import role utilities",
      "stage_name": "CLI Integration",
      "batch_name": "Router and Command Updates",
      "thread_name": "Approve Command",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "default",
      "sessions": [],
      "github_issue": {
        "number": 20,
        "url": "https://github.com/AlbertoV5/agenv/issues/20",
        "state": "open"
      }
    },
    {
      "id": "02.01.02.02",
      "name": "Add role check at command entry using `canExecuteCommand(\"approve\")` with early exit if denied",
      "stage_name": "CLI Integration",
      "batch_name": "Router and Command Updates",
      "thread_name": "Approve Command",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "default",
      "sessions": []
    },
    {
      "id": "02.01.02.03",
      "name": "Update `printHelp()` to include \"Requires: USER role\" note in header and explanation",
      "stage_name": "CLI Integration",
      "batch_name": "Router and Command Updates",
      "thread_name": "Approve Command",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "default",
      "sessions": []
    },
    {
      "id": "02.01.03.01",
      "name": "Update `packages/workstreams/src/cli/start.ts` to import role utilities and add role check at entry",
      "stage_name": "CLI Integration",
      "batch_name": "Router and Command Updates",
      "thread_name": "Start and Complete Commands",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "default",
      "sessions": [],
      "github_issue": {
        "number": 21,
        "url": "https://github.com/AlbertoV5/agenv/issues/21",
        "state": "open"
      }
    },
    {
      "id": "02.01.03.02",
      "name": "Update `start.ts` `printHelp()` to include USER role requirement note",
      "stage_name": "CLI Integration",
      "batch_name": "Router and Command Updates",
      "thread_name": "Start and Complete Commands",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "default",
      "sessions": []
    },
    {
      "id": "02.01.03.03",
      "name": "Update `packages/workstreams/src/cli/complete.ts` to import role utilities and add role check at entry",
      "stage_name": "CLI Integration",
      "batch_name": "Router and Command Updates",
      "thread_name": "Start and Complete Commands",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "default",
      "sessions": []
    },
    {
      "id": "02.01.03.04",
      "name": "Update `complete.ts` `printHelp()` to include USER role requirement note",
      "stage_name": "CLI Integration",
      "batch_name": "Router and Command Updates",
      "thread_name": "Start and Complete Commands",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "default",
      "sessions": []
    },
    {
      "id": "03.01.01.01",
      "name": "Write integration tests in `packages/workstreams/tests/cli-roles.test.ts` for CLI role enforcement",
      "stage_name": "Testing and Documentation",
      "batch_name": "Testing and Polish",
      "thread_name": "Role System Tests",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "code-reviewer",
      "sessions": [],
      "github_issue": {
        "number": 22,
        "url": "https://github.com/AlbertoV5/agenv/issues/22",
        "state": "open"
      }
    },
    {
      "id": "03.01.01.02",
      "name": "Test that `work approve` rejects with WORKSTREAM_ROLE=AGENT or unset, succeeds with WORKSTREAM_ROLE=USER",
      "stage_name": "Testing and Documentation",
      "batch_name": "Testing and Polish",
      "thread_name": "Role System Tests",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "code-reviewer",
      "sessions": []
    },
    {
      "id": "03.01.01.03",
      "name": "Test that `work start` and `work complete` follow the same role restrictions",
      "stage_name": "Testing and Documentation",
      "batch_name": "Testing and Polish",
      "thread_name": "Role System Tests",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "code-reviewer",
      "sessions": []
    },
    {
      "id": "03.01.01.04",
      "name": "Test that help output correctly filters commands based on role",
      "stage_name": "Testing and Documentation",
      "batch_name": "Testing and Polish",
      "thread_name": "Role System Tests",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "code-reviewer",
      "sessions": []
    },
    {
      "id": "03.01.01.05",
      "name": "Verify all tests pass with `bun run test` in packages/workstreams",
      "stage_name": "Testing and Documentation",
      "batch_name": "Testing and Polish",
      "thread_name": "Role System Tests",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "code-reviewer",
      "sessions": []
    },
    {
      "id": "03.01.02.01",
      "name": "Add inline code comments in `roles.ts` explaining the role system design and how to modify permissions",
      "stage_name": "Testing and Documentation",
      "batch_name": "Testing and Polish",
      "thread_name": "Documentation Updates",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "documentation-minimalist",
      "sessions": [],
      "github_issue": {
        "number": 23,
        "url": "https://github.com/AlbertoV5/agenv/issues/23",
        "state": "open"
      }
    },
    {
      "id": "03.01.02.02",
      "name": "Ensure all error messages are clear, actionable, and explain how to change roles",
      "stage_name": "Testing and Documentation",
      "batch_name": "Testing and Polish",
      "thread_name": "Documentation Updates",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "documentation-minimalist",
      "sessions": []
    },
    {
      "id": "03.01.02.03",
      "name": "Update any existing README or docs in packages/workstreams to document the WORKSTREAM_ROLE environment variable",
      "stage_name": "Testing and Documentation",
      "batch_name": "Testing and Polish",
      "thread_name": "Documentation Updates",
      "status": "pending",
      "created_at": "2026-01-23T15:37:12.282Z",
      "updated_at": "2026-01-23T15:37:12.282Z",
      "assigned_agent": "documentation-minimalist",
      "sessions": []
    }
  ]
}