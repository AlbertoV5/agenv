# Plan: Synthesis Agents

> **Stream ID:** 010-synthesis-agents | **Created:** 2026-01-23 | **Generated by:** @agenv/workstreams@0.1.0

## Summary

Add "synthesis agents" - wrapper agents that run working agents and synthesize summaries from their outputs. Synthesis agents observe and summarize what working agents accomplish, with summaries stored in threads.json for use in notifications (future TTS integration).

Key changes:
1. Extend agents.yaml to support `synthesis_agents` section
2. Update `work multi` to wrap thread execution with synthesis agents
3. Track working agent sessions separately from synthesis agent sessions
4. Create `synthesizing-workstreams` skill for synthesis agent behavior
5. Store synthesis output in threads.json
6. Prepare notification system for future TTS integration (add sound queueing)

## References

- `packages/workstreams/src/cli/multi.ts` - Main multi-thread execution
- `packages/workstreams/src/lib/multi-orchestrator.ts` - Thread collection and tmux setup
- `packages/workstreams/src/lib/opencode.ts` - Session listing and command building
- `packages/workstreams/src/lib/agents-yaml.ts` - Agent configuration parsing
- `packages/workstreams/src/lib/prompts.ts` - Prompt generation with skill references
- `packages/workstreams/src/lib/notifications.ts` - Notification system
- `packages/workstreams/src/lib/threads.ts` - Thread metadata storage
- `packages/workstreams/src/lib/types.ts` - Type definitions
- `~/.config/opencode/skills/implementing-workstreams/SKILL.md` - Example skill

## Stages

### Stage 01: Foundation

#### Stage Definition

Establish the core infrastructure for synthesis agents: extend types, parse synthesis_agents from agents.yaml, create the skill file, and double session listing capacity.

#### Stage Constitution

**Inputs:**
- `packages/workstreams/src/lib/agents-yaml.ts` - Current agents.yaml schema and parser
- `packages/workstreams/src/lib/types.ts` - Current type definitions
- `packages/workstreams/src/lib/opencode.ts` - Current session listing code
- `~/.config/opencode/skills/implementing-workstreams/SKILL.md` - Example skill

**Structure:**
- Batch 01: Types first (YAML parser depends on these types)
- Batch 02: YAML parsing, skill creation, and session listing in parallel

**Outputs:**
- Extended types for synthesis agents
- agents-yaml.ts capable of parsing `synthesis_agents` section
- synthesizing-workstreams skill file
- Doubled session listing capacity (--max-count 10 -> 20)

#### Stage Questions

- [x] Where should the skill file be created? ~/.config/opencode/skills/synthesizing-workstreams/SKILL.md

#### Stage Batches

##### Batch 01: Type Definitions

Types must be defined first since the YAML parser imports them.

###### Thread 01: Types and Schema

**Summary:**
Extend type definitions to support synthesis agents in agents.yaml and synthesis output in threads.json.

**Details:**
- Working packages: `./packages/workstreams`
- Add to types.ts:
  - `SynthesisAgentDefinitionYaml` interface (similar to `AgentDefinitionYaml` but for synthesis)
  - Extend `AgentsConfigYaml` to include optional `synthesis_agents?: SynthesisAgentDefinitionYaml[]`
  - Add `synthesisOutput?: string` field to `ThreadMetadata` for storing synthesis summaries
  - Add `workingAgentSessionId?: string` to `ThreadMetadata` to track the working agent's opencode session (distinct from `opencodeSessionId` which tracks the outer/synthesis session)

**Session ID Clarification:**
- `opencodeSessionId`: The opencode session ID of the outermost agent (synthesis agent when enabled, otherwise working agent)
- `workingAgentSessionId`: The opencode session ID of the working agent specifically (only set when synthesis is enabled)
- `currentSessionId`: Internal session tracking ID (not an opencode session)
- For `work fix --resume`, we use `workingAgentSessionId` when available, falling back to `opencodeSessionId`

##### Batch 02: Parser, Skill, and Session Capacity

These can run in parallel after types are defined.

###### Thread 01: YAML Parser Extension

**Summary:**
Extend agents-yaml.ts to parse the new `synthesis_agents` section.

**Details:**
- Working packages: `./packages/workstreams`
- Extend `parseAgentsYaml()` to handle `synthesis_agents` array
- Add `getSynthesisAgent()` function to get a synthesis agent by name
- Add `getDefaultSynthesisAgent()` to get first synthesis agent or null
- Validate synthesis agent models same as regular agents

**Example agents.yaml schema:**
```yaml
agents:
  - name: default
    description: General-purpose implementation agent.
    best_for: Standard development tasks.
    models: [anthropic/claude-sonnet-4-5]

synthesis_agents:
  - name: batch-synthesizer
    description: Summarizes working agent outputs after completion.
    best_for: Generating concise summaries of completed work.
    models: [anthropic/claude-sonnet-4-5]
```

###### Thread 02: Create Synthesizing Skill

**Summary:**
Create the synthesizing-workstreams skill file that synthesis agents will use.

**Details:**
- Create file: `~/.config/opencode/skills/synthesizing-workstreams/SKILL.md`
- Skill instructs agent to:
  1. Run the provided opencode command to execute the working agent
  2. After completion, review the session output
  3. Generate a concise summary (2-3 sentences) of what was accomplished
  4. Output the summary in a specific format for parsing
- Include guidance on summary format: focus on what was done, key changes, any issues
- Test the skill loads correctly with opencode's skill loader

###### Thread 03: Double Session Listing

**Summary:**
Double the session listing capacity from 10 to 20 to handle synthesis agent sessions alongside working agent sessions.

**Details:**
- Working packages: `./packages/workstreams`
- In opencode.ts, find `--max-count 10` in `buildRunCommand()` and `buildRetryRunCommand()`
- Change to `--max-count 20`
- This ensures we can find the working agent session even when multiple synthesis sessions exist

### Stage 02: Integration

#### Stage Definition

Integrate synthesis agents into the multi execution flow. Modify how threads are executed to wrap them with synthesis agents, track working agent sessions correctly, and store synthesis output.

#### Stage Constitution

**Inputs:**
- Extended types and YAML parser from Stage 01
- `packages/workstreams/src/cli/multi.ts` - Current multi.ts execution flow
- `packages/workstreams/src/lib/threads.ts` - Current thread metadata storage

**Structure:**
- Parallel work on command building, session tracking, and output storage
- Sequential integration into multi.ts

**Outputs:**
- Modified command builder for synthesis wrapper
- Working agent session tracking
- Synthesis output storage in threads.json

#### Stage Questions

- [x] How does synthesis agent wrap the working agent? It runs `opencode run` with a prompt that includes the working agent command, then synthesizes after completion
- [x] How to capture working agent session ID? Parse from the synthesis agent's output or use the existing tracking mechanism with temp files

#### Stage Batches

##### Batch 01: Command and Session Building

Build the synthesis wrapper command and session tracking logic.

###### Thread 01: Synthesis Command Builder

**Summary:**
Create function to build the synthesis agent command that wraps the working agent execution.

**Details:**
- Working packages: `./packages/workstreams`
- Add `buildSynthesisRunCommand()` to opencode.ts that wraps `buildRetryRunCommand()` internally
- The synthesis command:
  1. Generates unique tracking IDs for both synthesis and working agents
  2. Runs opencode with the synthesis agent's model
  3. The prompt tells synthesis agent to run the working agent command
  4. After working agent completes, synthesis agent summarizes
  5. Synthesis output is written to a temp file for capture
- The working agent's original command (from buildRetryRunCommand) becomes part of the synthesis prompt
- Track both session IDs in separate temp files
- Use streamId prefix for temp files: `/tmp/workstream-{streamId}-{threadId}-synthesis.txt`

**Error Handling:**
- If synthesis agent fails, still capture working agent session ID if available
- If working agent crashes, synthesis agent should note this in summary
- If synthesis output file is empty/missing, log warning but don't fail the thread

###### Thread 02: Working Session Tracker

**Summary:**
Add logic to track and store the working agent session ID separately from synthesis session.

**Details:**
- Working packages: `./packages/workstreams`
- Extend threads.ts with functions:
  - `setWorkingAgentSessionId(repoRoot, streamId, threadId, sessionId)`
  - `getWorkingAgentSessionId(repoRoot, streamId, threadId)`
- The working agent session ID is what we want to use for `work fix --resume`
- Update multi.ts session close handler to capture and store both session IDs

##### Batch 02: Multi Integration

Integrate synthesis agents into the multi execution flow.

###### Thread 01: Multi Orchestrator Update

**Summary:**
Update multi.ts and multi-orchestrator.ts to use synthesis agents when available.

**Details:**
- Working packages: `./packages/workstreams`
- In multi.ts main():
  1. Load synthesis agent config (getDefaultSynthesisAgent)
  2. If synthesis agent exists, use buildSynthesisRunCommand instead of buildRetryRunCommand
  3. Pass both working agent models and synthesis agent model to command builder
- In collectThreadInfoFromTasks():
  - Add optional synthesisAgentName and synthesisModels to ThreadInfo
- Update setupTmuxSession to handle synthesis commands
- Ensure session close handler captures working agent session ID for threads.json

###### Thread 02: Synthesis Output Storage

**Summary:**
Capture and store synthesis output in threads.json after thread completion.

**Details:**
- Working packages: `./packages/workstreams`
- In multi.ts handleSessionClose():
  1. Read synthesis output from temp file (uses streamId prefix: `/tmp/workstream-{streamId}-{threadId}-synthesis.txt`)
  2. Call updateThreadMetadataLocked with synthesisOutput
  3. Log warning if synthesis output is empty/missing but continue normally
- Add temp file path helper: `getSynthesisOutputPath(streamId, threadId)` in opencode.ts
- Add cleanup for synthesis output temp files in marker-polling.ts

**Error Handling:**
- Missing synthesis file: Log warning, set synthesisOutput to null
- Empty synthesis file: Log warning, set synthesisOutput to empty string
- Malformed content: Store as-is (synthesis agent responsible for format)

### Stage 03: Notification Enhancements

#### Stage Definition

Prepare the notification system for future TTS integration by adding sound queueing capability and exposing synthesis output through the notification payload.

#### Stage Constitution

**Inputs:**
- `packages/workstreams/src/lib/notifications.ts` - Current notifications.ts architecture
- Synthesis output stored in `threads.json` from Stage 02

**Structure:**
- Add sound queue to prevent overlapping sounds
- Extend notification payload to include synthesis summary

**Outputs:**
- NotificationManager with sound queueing
- Notification payload includes synthesis output
- Ready for TTS service integration

#### Stage Questions

- [x] Should sounds queue or skip if one is playing? Queue - ensures all notifications are heard
- [x] How does TTS fit in? Future ExternalApiProvider or TTSProvider would receive synthesis output in payload

#### Stage Batches

##### Batch 01: Notification Enhancements

Enhance notification system for future TTS integration.

###### Thread 01: Sound Queue Implementation

**Summary:**
Add sound queueing to MacOSSoundProvider to prevent overlapping sounds when multiple threads complete simultaneously.

**Details:**
- Working packages: `./packages/workstreams`
- Modify MacOSSoundProvider class:
  - Add private queue: string[] for pending sound paths
  - Add isPlaying: boolean flag
  - Modify playNotification to queue sounds instead of spawning immediately
  - Add playNext() method to play from queue when current sound finishes
  - Use afplay's exit event to trigger next sound
- This prepares for TTS where we'd want summaries read sequentially

###### Thread 02: Notification Payload Extension

**Summary:**
Extend webhook payload and notification events to include synthesis output for future TTS.

**Details:**
- Working packages: `./packages/workstreams`
- Extend NotificationEvent type or add new event: "thread_synthesis_complete"
- Add metadata option to playNotification for passing synthesis output
- Extend WebhookPayload to include synthesisOutput field
- Update NotificationTracker to accept and pass through synthesis data
- Add helper method: playSynthesisComplete(threadId, synthesisOutput)
- This sets up the interface for a future TTSProvider to receive summaries
- Maintain backward compatibility: existing notification consumers unaffected

### Stage 04: Documentation

#### Stage Definition

Document the synthesis agents feature for users and future maintainers.

#### Stage Constitution

**Inputs:**
- Completed implementation from Stages 01-03
- Existing skill files as examples

**Structure:**
- Single thread for documentation updates

**Outputs:**
- Updated README or docs with synthesis agent configuration
- Inline code documentation

#### Stage Questions

- [x] Where should documentation live? In the skill file and inline code comments (no separate docs folder exists)

#### Stage Batches

##### Batch 01: Documentation

###### Thread 01: Documentation Updates

**Summary:**
Document synthesis agents configuration and usage.

**Details:**
- Working packages: `./packages/workstreams`
- Update synthesizing-workstreams skill with complete usage instructions
- Add JSDoc comments to new functions in agents-yaml.ts, opencode.ts, threads.ts
- Add inline comments explaining session ID relationships in types.ts
- Document the agents.yaml schema for synthesis_agents in code comments

---

*Last updated: 2026-01-23*

### Stage 05: Revision - Notification Configuration

#### Stage Definition

Add a centralized `notifications.json` configuration file at `work/notifications.json` that allows users to configure notification providers (macOS sounds, macOS Notification Center, terminal-notifier, future TTS).

#### Stage Constitution

**Inputs:**
- `packages/workstreams/src/lib/notifications.ts` - Current notification system with MacOSSoundProvider
- Research on notification options (osascript, terminal-notifier, tmux hooks)

**Structure:**
- Create configuration schema and loader
- Add macOS Notification Center provider (osascript)
- Add terminal-notifier provider (optional, with feature detection)
- Update NotificationManager to use config

**Outputs:**
- `work/notifications.json` configuration file schema
- Multiple notification provider support
- User-configurable notification preferences

#### Stage Questions

- [x] Where should config live? `work/notifications.json` (alongside agents.yaml and github.json)
- [x] What providers to support initially? macOS sounds (existing), macOS Notification Center (osascript), terminal-notifier (optional)
- [x] How to handle missing dependencies? Feature detection - gracefully skip if terminal-notifier not installed
- [x] VSCode integration possible? No direct API - would require a VSCode extension (out of scope for now)

#### Stage Batches

##### Batch 01: Configuration Schema

Define the configuration file format and loader.

###### Thread 01: Config Schema and Loader

**Summary:**
Create the notifications.json schema and configuration loader.

**Details:**
- Working packages: `./packages/workstreams`
- Create `NotificationsConfig` interface in types.ts:
  ```typescript
  interface NotificationsConfig {
    enabled: boolean
    providers: {
      sound?: { enabled: boolean; volume?: number }
      notification_center?: { enabled: boolean }
      terminal_notifier?: { enabled: boolean; click_action?: "activate_vscode" | "open_url" | "none" }
      tts?: { enabled: boolean; voice?: string }  // Future
    }
    events: {
      thread_complete?: boolean
      batch_complete?: boolean
      error?: boolean
      synthesis_complete?: boolean
    }
  }
  ```
- Add `loadNotificationsConfig()` function to load from `work/notifications.json`
- Add `getDefaultNotificationsConfig()` for sensible defaults
- Create default `notifications.json` during `work init`

##### Batch 02: Notification Providers

Add new notification providers.

###### Thread 01: macOS Notification Center Provider

**Summary:**
Add a provider that uses osascript to show macOS Notification Center notifications.

**Details:**
- Working packages: `./packages/workstreams`
- Create `MacOSNotificationCenterProvider` class implementing `NotificationProvider`
- Use `osascript -e 'display notification "message" with title "title" sound name "default"'`
- Support title, message, and optional sound
- Include synthesis output in notification body when available
- Always available on macOS (no external dependencies)

###### Thread 02: Terminal Notifier Provider

**Summary:**
Add an optional provider for terminal-notifier with enhanced features.

**Details:**
- Working packages: `./packages/workstreams`
- Create `TerminalNotifierProvider` class implementing `NotificationProvider`
- Feature detection: check if `terminal-notifier` is in PATH
- Support enhanced features:
  - Custom app icon
  - Click to activate VSCode (`-activate com.microsoft.VSCode`)
  - Notification grouping (`-group workstreams`)
- Log helpful message if terminal-notifier not installed but enabled in config
- Command: `terminal-notifier -title "Title" -message "Message" -sound default -activate "com.microsoft.VSCode" -group "workstreams"`

##### Batch 03: Integration

Wire up the new providers to the NotificationManager.

###### Thread 01: NotificationManager Update

**Summary:**
Update NotificationManager to load config and initialize configured providers.

**Details:**
- Working packages: `./packages/workstreams`
- Modify `NotificationManager` constructor to accept optional `repoRoot` parameter
- Load `notifications.json` from `work/notifications.json` if repoRoot provided
- Fall back to `~/.config/agenv/notifications.json` for global config (existing behavior)
- Initialize only enabled providers based on config
- Update `playNotification()` to respect per-event configuration
- Update multi.ts to pass repoRoot when creating NotificationManager

###### Thread 02: Documentation and Defaults

**Summary:**
Document the notification configuration and create sensible defaults.

**Details:**
- Working packages: `./packages/workstreams`
- Update `work init` to create default `notifications.json`:
  ```json
  {
    "enabled": true,
    "providers": {
      "sound": { "enabled": true },
      "notification_center": { "enabled": true },
      "terminal_notifier": { "enabled": false }
    },
    "events": {
      "thread_complete": true,
      "batch_complete": true,
      "error": true,
      "synthesis_complete": true
    }
  }
  ```
- Add `work notifications` command to show current config and provider status
- Update README with notification configuration section

### Stage 06: Revision - Post-Session Synthesis

#### Stage Definition

Refactor synthesis agents to run AFTER the working agent completes, rather than wrapping it. This preserves the full TUI experience for working agents while still providing synthesis summaries.

**Key Changes:**
1. Working agent runs directly in tmux (user sees full TUI output)
2. After working agent completes, export session and extract text messages
3. Run synthesis agent headless (`opencode run --format json`) with extracted context
4. Open the WORKING agent's session (not synthesis) for user review
5. Notifications run after synthesis completes

**Current Architecture (wrapper - being replaced):**
```
┌─────────────────────────────────┐
│ Synthesis Agent (wrapper)       │
│  └─ Working Agent (nested)      │  ← Output hidden in nested run
└─────────────────────────────────┘
```

**New Architecture (post-session):**
```
┌─────────────────────────────────┐
│ Working Agent                   │  ← Full TUI visible in tmux
└─────────────────────────────────┘
              ↓ completes
┌─────────────────────────────────┐
│ opencode export <session_id>    │  ← Get full transcript
└─────────────────────────────────┘
              ↓
┌─────────────────────────────────┐
│ Extract text messages           │  ← Only assistant text, not tool calls
└─────────────────────────────────┘
              ↓
┌─────────────────────────────────┐
│ Synthesis Agent (headless)      │  ← opencode run --format json
└─────────────────────────────────┘
              ↓
┌─────────────────────────────────┐
│ Notification (with synthesis)   │
└─────────────────────────────────┘
              ↓
┌─────────────────────────────────┐
│ Open working agent session      │  ← User reviews actual work
└─────────────────────────────────┘
```

#### Stage Constitution

**Inputs:**
- `packages/workstreams/src/lib/opencode.ts` - Current synthesis wrapper implementation
- `packages/workstreams/src/cli/multi.ts` - Current multi execution flow
- `t.json` export sample - Shows structure of `opencode export` output
- `~/.config/opencode/skills/synthesizing-workstreams/SKILL.md` - Synthesis skill to update

**Structure:**
- Batch 01: Session export and message extraction utilities
- Batch 02: Refactor command builder and multi.ts flow
- Batch 03: Update skill and documentation

**Outputs:**
- `extractTextMessages(exportJson)` function to stitch text messages
- Refactored `buildPostSynthesisCommand()` replacing wrapper approach
- Updated multi.ts flow: working agent → export → synthesis → open session
- Updated synthesis skill for post-session context

#### Stage Questions

- [x] What messages to extract? Only assistant `text` parts (not tool calls, not user prompts)
- [x] How to run synthesis headless? `opencode run --format json` pipes output, doesn't use TUI
- [x] Where to run synthesis? In the same tmux pane, after working agent completes
- [x] How to pass context to synthesis? Pipe extracted text via stdin or temp file

#### Stage Batches

##### Batch 01: Session Export Utilities

Create utilities for exporting and parsing opencode sessions.

###### Thread 01: Session Export and Text Extraction

**Summary:**
Create functions to export opencode sessions and extract text messages for synthesis context.

**Details:**
- Working packages: `./packages/workstreams`
- Create `session-export.ts` in `packages/workstreams/src/lib/`:
  - `exportSession(sessionId: string): Promise<SessionExport>` - Runs `opencode export <id>` and parses JSON
  - `extractTextMessages(exportData: SessionExport): string` - Extracts only assistant text parts
  - `SessionExport` interface matching the export JSON structure (info, messages, parts)
  - `MessagePart` interface with type discrimination for text/tool/step-start/step-finish/patch
- Focus on extracting `type: "text"` parts from assistant messages only
- Concatenate text parts in order with newlines between messages
- Handle edge cases: empty sessions, sessions with no text parts, malformed JSON

**Export JSON Structure (from t.json analysis):**
```typescript
interface SessionExport {
  info: { id: string; title: string; summary: { additions: number; deletions: number; files: number } }
  messages: Array<{
    info: { id: string; role: "user" | "assistant"; /* ... */ }
    parts: Array<
      | { type: "text"; text: string }
      | { type: "tool"; tool: string; state: { input: object; output: string } }
      | { type: "step-start" | "step-finish" | "patch"; /* ... */ }
    >
  }>
}
```

##### Batch 02: Command and Flow Refactor

Refactor the synthesis command builder and multi.ts execution flow.

###### Thread 01: Post-Synthesis Command Builder

**Summary:**
Replace the wrapper-based synthesis command with a post-session approach.

**Details:**
- Working packages: `./packages/workstreams`
- In `opencode.ts`:
  - Keep `buildRetryRunCommand()` as the primary working agent command (unchanged)
  - Add `buildPostSynthesisCommand(options)` that:
    1. Runs working agent normally (existing buildRetryRunCommand)
    2. After completion, exports the session: `opencode export $WORK_SESSION_ID`
    3. Extracts text messages using a helper script or inline jq
    4. Runs synthesis agent headless: `echo "$CONTEXT" | opencode run --format json --model X`
    5. Captures synthesis output
    6. Opens the WORKING agent session (not synthesis)
  - Remove or deprecate `buildSynthesisRunCommand()` (wrapper approach)
- The shell script flow:
  ```bash
  # 1. Run working agent (full TUI)
  cat prompt.md | opencode run --model X --title "ThreadName__work_id=123"
  WORK_EXIT=$?
  
  # 2. Find working session ID
  WORK_SESSION=$(opencode session list --max-count 5 --format json | jq -r '...')
  
  # 3. Export session
  opencode export "$WORK_SESSION" > /tmp/session.json
  
  # 4. Extract text messages (jq or bun script)
  CONTEXT=$(cat /tmp/session.json | jq -r '.messages[] | select(.info.role=="assistant") | .parts[] | select(.type=="text") | .text')
  
  # 5. Run synthesis headless
  echo "Summarize: $CONTEXT" | opencode run --format json --model Y > /tmp/synthesis.json
  
  # 6. Extract synthesis output
  SYNTHESIS=$(cat /tmp/synthesis.json | jq -r '...')
  echo "$SYNTHESIS" > /tmp/synthesis-output.txt
  
  # 7. Open working session for review
  opencode --session "$WORK_SESSION"
  ```

###### Thread 02: Multi.ts Flow Update

**Summary:**
Update multi.ts to use post-session synthesis instead of wrapper.

**Details:**
- Working packages: `./packages/workstreams`
- In `multi-orchestrator.ts`:
  - Update `buildThreadRunCommand()` to use `buildPostSynthesisCommand()` when synthesis is enabled
  - Pass synthesis models separately from working models
- In `multi.ts`:
  - Keep synthesis agent detection logic
  - Update session capture to focus on working agent session
  - Synthesis output capture remains the same (reads from temp file)
- The key change: working agent runs directly with TUI, synthesis runs after as a separate headless step
- Remove references to "synthesis wrapping working agent" in comments

##### Batch 03: Skill and Documentation Update

Update the synthesis skill and documentation.

###### Thread 01: Update Synthesis Skill

**Summary:**
Rewrite the synthesizing-workstreams skill for post-session context.

**Details:**
- Update `~/.config/opencode/skills/synthesizing-workstreams/SKILL.md`:
  - Remove instructions about running working agent (it already ran)
  - Focus on: "You are given the text output from a completed working agent session"
  - Instruct to summarize what was accomplished
  - Keep summary format guidelines (2-3 sentences, focus on changes made)
  - Note that context is piped via stdin
- Example new skill content:
  ```markdown
  # Synthesizing Workstreams
  
  You are a synthesis agent reviewing a completed working agent session.
  
  ## Context
  The text below contains the assistant's responses from a workstream thread.
  The working agent has already completed its tasks.
  
  ## Your Task
  Write a concise summary (2-3 sentences) of what the working agent accomplished.
  Focus on:
  - What was implemented or changed
  - Key files modified
  - Any issues encountered
  
  ## Output
  Write ONLY the summary, nothing else.
  ```

###### Thread 02: Documentation Update

**Summary:**
Update documentation to reflect the new post-session synthesis flow.

**Details:**
- Working packages: `./packages/workstreams`, root README
- Update inline code comments in:
  - `opencode.ts` - Document post-synthesis approach
  - `multi.ts` - Update synthesis flow comments
  - `multi-orchestrator.ts` - Update command building docs
- Update README synthesis agents section to describe:
  - Working agent runs with full TUI
  - Synthesis runs after, headless
  - User always resumes into working agent session
- Remove references to "wrapper" or "nested" execution
